<launch>

  <arg name = "name_robot" value = "$(eval 'agent' + str(arg('agents')))"/>
  <group ns="$(arg name_robot)">
  
    <node pkg="lpv_mpc" type="vehicleSimulator.py" name="simulator" output="screen">

        <param name="publish_frequency" type="double" value="10.0" />
        <param name="dt"          type="double" value="0.005" />
        <!-- sensor freq update -->
        <param name="gps_freq_update" type="double" value="1000.0" />

        <!-- delay in the simulator -->
        <param name="lowLevelDyn" type="bool" value="false" />
        <param name="delay_df"    type="double" value="0.0" />
        <param name="delay_a"     type="double" value="0.0" />

        <!-- simulator sensor noise -->
        <param name="n_bound_pr"     type="double" value="2.0" />
        <param name="x_std_pr"       type="double" value="0.0034" />
        <param name="y_std_pr"       type="double" value="0.0034" />
        <param name="psi_std_pr"     type="double" value="0.0034" />

        <!--<param name="vx_std_pr"       type="double" value="0.005" />
        <param name="vy_std_pr"       type="double" value="0.0045" />
        <param name="psiDot_std_pr"  type="double" value="0.0035" /> -->

        <param name="vx_std_pr"       type="double" value="0.01" />
        <param name="vy_std_pr"       type="double" value="0.0" />
        <param name="psiDot_std_pr"  type="double" value="0.01" />



        <param name="n_bound"     type="double" value="2.0" />

        <param name="x_std"       type="double" value="0.04" />    <!-- old: 0.035 -->
        <param name="y_std"       type="double" value="0.04" />    <!-- old: 0.035 -->
        <param name="psi_std"     type="double" value="0.04" />    <!-- old: 0.087 -->

        <param name="vx_std"       type="double" value="0.01" />   <!-- old:  -->
        <param name="vy_std"       type="double" value="0.00" />    <!-- old:  -->
        <param name="psiDot_std"  type="double" value="0.01" />     <!-- old:  -->

        <param name="du_0"        type="double" value="0.1" />
        <param name="du_1"        type="double" value="0.05" />
        <param name="u_bound"     type="double" value="1.0" />

        <!-- simulator disturbance parameters -->

        <param name="dist_mode"  type="bool"     value="0" />
        <param name="mu_sf"      type="double"   value="0.1"/>
        <param name="Cd"         type="double"   value="0.020"/>
        <param name="A_car"      type="double"   value="0.03"/>

        <param name="init_x"    type="double" value="0.0" />
        <param name="init_y"    type="double" value="0.0" />
        <param name="init_yaw"  type="double" value="0.0" />

        <arg name="agents"        value="$(eval arg('agents'))"/>

    </node>
    
    <!-- CONTROL -->
    <node pkg="lpv_mpc" type="controllerMain.py" name="control" output="screen">
        <param name="mode"        type="str"     value="simulations" />
        <param name="saveData"    type="bool"    value="true" />
        <param name="N"           type="int"     value="20" />
        <param name="Hz"          type="double"  value="30" />
        <param name="vel_ref"     type="double"  value="2.5"/>
        <param name="vel_th"      type="double"  value="0.0" />
        <arg name="agents"        value="$(eval arg('agents'))"/>
    </node>
  </group>

  <include file="$(find lpv_mpc)/launch/control_spawner.launch" if="$(eval arg('agents') - 1 > 0)">
    <arg name="agents" value="$(eval arg('agents') - 1)"/>
  </include>
</launch>
